## 改进的KernelGAN+ZSSR：SSNSRN代码使用说明

### by 端木笑傲



### 安装依赖

代码目录下的requirements.txt注明了代码所需的依赖包，只需要在代码文件夹路径下输入命令：

`pip install -r requirements.txt -i `   *如果下载速度过慢，可以自行换源*



### 简单的使用方法

##### 命令行输入命令：

`python train.py -[arguments]`

arguments代表附加参数



### 附加参数都有啥？

`--input-dir` 设定**输入图片**文件夹路径

`--output-dir` 设定**结果输出**文件夹路径

`--SR` 启用**超分辨**（ZSSR）

`--X4` 设定超分辨倍数为4倍

`--real`， `--noise_scale` 暂时用不到



### 举几个例子

*下列所举例子中的参数顺序都是任意的*



**假如，现在我想计算当前路径下imgs文件夹里的图片的两倍模糊核，但是不执行超分辨：**

*(假定当前路径就是train.py文件的路径)*

 `python train.py --input-dir ./imgs`



**在上面的情况下，如果我想把放大倍数改为4倍：**

`python train.py --input-dir ./imgs --X4`



**现在，我想对这些图像进行超分辨了，并且要把输入图像存放到当前路径下的output_imgs文件夹中：**

`python train.py --input-dir ./imgs --output-dir ./output_imgs --SR`



## 网络训练选项相关



### 约束项权重

模糊核估计部分的各个约束项，都有各自的权重，定义在:



**KernelGAN.py  (Line10-14)**

```python
    lambda_sum2one = 2
    lambda_bicubic = 0.001
    lambda_boundaries = 0.
    lambda_centralized = 0.
    lambda_sparse = 2
```

此处定义的是各个参数的初始值



**learner.py   (Line3-10)**

```python
    lambda_update_freq = 200  # 权重更新周期
    bic_loss_to_start_change = 0.4  # 理想核约束权重开始更新的损失临界值
    lambda_bicubic_decay_rate = 10.  # 理想核约束权重衰减率
    update_l_rate_freq = 1500  # 学习率更新周期
    update_l_rate_rate = 10.  # 学习率衰减率
    lambda_sparse_end = 5  # sparse权重停止更新临界值
    lambda_centralized_end = 0.  # centralized权重停止更新临界值
    lambda_bicubic_min = 5e-3  # 理想核权重停止更新临界值
```

此处定义的是训练过程中各个参数的更新选项，具体解释如注释



### KernelGAN网络训练轮数

定义在**configs.py  （Line30）**，通过更改default参数的值来更改训练轮数

```python
self.parser.add_argument('--max_iters', type=int, default=7000, help='训练轮数')
```

*其实这里和之前的命令行参数一样，可以通过命令行来指定，不过暂时还没做这项更新，以后可以做一下*



### ZSSR网络训练轮数

定义在**ZSSRforKernelGAN/zssr_configs.py (Line9-10)**

```python
max_iters = 4000 # 最大训练轮数
min_iters = 250 # 最小训练轮数
```



### KernelGAN理想核

定义在**loss.py  (Line38-45)**， 一个8x8的矩阵，可使用matlab查看生成的.m文件，把矩阵值替换，达到更换理想核的目的

```python
bicubic_k = [[0.0001373291015625, 0.0004119873046875, -0.0013275146484375, -0.0050811767578125, -0.0050811767578125, -0.0013275146484375, 0.0004119873046875, 0.0001373291015625],
             [0.0004119873046875, 0.0012359619140625, -0.0039825439453125, -0.0152435302734375, -0.0152435302734375, -0.0039825439453125, 0.0012359619140625, 0.0004119873046875],
             [-.0013275146484375, -0.0039825439453130, 0.0128326416015625, 0.0491180419921875, 0.0491180419921875, 0.0128326416015625, -0.0039825439453125, -0.0013275146484375],
             [-.0050811767578125, -0.0152435302734375, 0.0491180419921875, 0.1880035400390630, 0.1880035400390630, 0.0491180419921875, -0.0152435302734375, -0.0050811767578125],
             [-.0050811767578125, -0.0152435302734375, 0.0491180419921875, 0.1880035400390630, 0.1880035400390630, 0.0491180419921875, -0.0152435302734375, -0.0050811767578125],
             [-.0013275146484380, -0.0039825439453125, 0.0128326416015625, 0.0491180419921875, 0.0491180419921875, 0.0128326416015625, -0.0039825439453125, -0.0013275146484375],
             [0.0004119873046875, 0.0012359619140625, -0.0039825439453125, -0.0152435302734375, -0.0152435302734375, -0.0039825439453125, 0.0012359619140625, 0.0004119873046875],
             [0.0001373291015625, 0.0004119873046875, -0.0013275146484375, -0.0050811767578125, -0.0050811767578125, -0.0013275146484375, 0.0004119873046875, 0.0001373291015625]]
```



## 获取实验数据集

可以和我联系，qq：372991816

#### 百度网盘

链接：https://pan.baidu.com/s/1C3YtMJozbAUzxbUH_XRU5Q 
提取码：dmxa
